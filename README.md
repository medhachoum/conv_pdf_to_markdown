# محوِّل دفعات PDF إلى Markdown مع تتبُّع وتحكُّم

هذا المستودع يحتوي على سكربت Python لتحويل ملفات PDF المصفحة ضوئيًا (`OCR`) إلى ملفات Markdown (`.md`) دفعة واحدة، مع تسجيل الحالتين الناجحة والفاشلة في قاعدة بيانات CSV وطباعة سجل التشغيل في ملف لوج.

---

## 📋 الوصف

- **المهمة**: مسح مجلد `doc/` بحثًا عن كل ملفات PDF، ثم تحويلها إلى ملفات Markdown باستخدام خدمة Mistral OCR.
- **تتبع**: يستخدم CSV (`processed_files.csv`) لتسجيل: اسم الملف، الحالة (`success` أو `error`)، عدد المحاولات، ورسالة الخطأ.
- **سجل أخطاء**: يُسجَّل في `conversion.log` بواسطة مكتبة `logging` المدمجة.
- **إعادة المحاولة**: عند فشل التحويل، يعيد المحاولة حتى 5 مرات مع تأخير يتضاعف (exponential backoff).
- **بيئة التشغيل**: يعتمد على متغير بيئي `MISTRAL_API_KEY` المُحمَّل من ملف `.env` في جذر المشروع.

---

## 🛠 المتطلبات

- Python 3.7 أو أحدث
- مكتبة Mistral AI SDK

```bash
pip install mistralai
````

> *اختياري*: إذا فضّلت استخدام مكتبة `python-dotenv` لتحميل متغيرات البيئة بدل اللودر المدمج:
>
> ```bash
> pip install python-dotenv
> ```

---

## ⚙️ الإعداد

1. **استنساخ المستودع**:

   ```bash
   git clone https://github.com/username/repo-name.git
   cd repo-name
   ```

2. **إنشاء ملف `.env` في جذر المشروع** ووضع مفتاح API:

   ```text
   MISTRAL_API_KEY=SB6B01uJMUWzpwu7MsqStV3UZaoj0zOB
   ```

3. **تثبيت المتطلبات**:

   ```bash
   pip install mistralai
   # أو مع python-dotenv:
   # pip install mistralai python-dotenv
   ```

4. **إنشاء مجلد `doc/` ووضع ملفات PDF داخله**:

   ```bash
   mkdir doc
   cp /path/to/*.pdf doc/
   ```

---

## 🚀 طريقة التشغيل

```bash
python pdf_to_md_batch_converter.py
```

* عند البداية، سيطبع السكربت إحصائية بعدد ملفات PDF الموجودة وعدد الملفات المحوَّلة سابقًا وعدد المتبقي.
* أثناء التشغيل، يظهر تقدم التحويل لكل ملف.
* بعد الانتهاء، يطبع ملخص عدد التحويلات الناجحة.

---

## 💡 تفاصيل السكربت

* **تحميل متغيرات البيئة**:

  * دالة `load_dotenv()` المدمجة تُحمّل `.env` بدون مكتبات خارجية.
  * إذا فضلت استخدام `python-dotenv`، استبدل الجزء:

    ```python
    # from dotenv import load_dotenv
    # load_dotenv()
    ```

* **الإعدادات الرئيسية**:

  ```python
  DOC_DIR = "doc"                  # مجلد البحث عن PDF
  DB_CSV = "processed_files.csv"  # قاعدة بيانات تتبع CSV
  LOG_FILE = "conversion.log"     # ملف سجل الأخطاء
  MAX_RETRIES = 5                   # حد إعادة المحاولة
  INITIAL_BACKOFF = 1               # الثواني الابتدائية للانتظار
  SLEEP_AFTER_CONVERSION = 3       # ثواني بعد كل تحويل ناجح
  ```

* **تدفق العمل**:

  1. تحميل سجل الملفات المحوَّلة سابقًا من CSV.
  2. جلب قائمة ملفات PDF في `doc/`.
  3. تجاهل الملفات الناجحة في الجولات الماضية.
  4. لكل ملف:

     * تحويله باستخدام OCR.
     * إنشاء ملف Markdown بنفس الاسم.
     * تسجيل النتيجة (نجاح أو فشل) في CSV.
     * عند الفشل، تكرار المحاولة حتى 5 مرات مع تأخير أُسّي.

---

## 📦 نتائج التشغيل

* ملفات `.md` الناتجة (بنفس أسماء ملفات PDF) تُنشأ في جذر المشروع.
* `processed_files.csv` يحوي سجل تحويل كل ملف.
* `conversion.log` يحتوي على تفاصيل الأخطاء والتوقيتات.

---

## 📝 الترخيص

هذا المشروع مرخص بموجب رخصة MIT.


